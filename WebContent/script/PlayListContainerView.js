// Generated by CoffeeScript 1.4.0
(function() {

  define(['jQuery', 'Underscore', 'Backbone', 'ListModel', 'PlayListCollection', 'backpack/components/ListView', 'PlayItemView', 'backpack/plugins/Sortable', 'text!template/PlayListContainerView.html'], function($, _, Backbone, ListModel, PlayListCollection, ListView, PlayItemView, Sortable, viewTemplate) {
    return Backbone.View.extend({
      el: "#playListContainerView",
      template: _.template(viewTemplate),
      events: {
        "click .songListBtn": "close"
      },
      initialize: function() {
        var collection, view;
        this.render();
        collection = new PlayListCollection(null, {
          model: ListModel,
          subscribers: {
            SONG_FINISHED: 'onSongFinished'
          }
        });
        view = this.listView = new ListView({
          collection: collection,
          el: '#playListView',
          itemClass: PlayItemView,
          plugins: [Sortable],
          subscribers: {
            PLAYLIST_INDEX_UPDATED: this.onCurrentIndexUpdated
          },
          onCurrentIndexUpdated: function(index) {
            if (this._nowPlayingView) {
              this._nowPlayingView.$el.removeClass('now-playing');
            }
            if (index !== -1) {
              view = this._nowPlayingView = this.getChild(index);
              view.$el.addClass('now-playing');
            }
          }
        });
        view.render();
        Backbone.on("SHOW_PLAYLIST", this.open, this);
      },
      render: function() {
        this.$el.html(this.template());
        this.$el.dialog({
          autoOpen: false,
          width: $(window).width(),
          height: $(window).height()
        });
        return this;
      },
      open: function() {
        this.$el.dialog('open');
      },
      close: function() {
        this.$el.dialog('close');
      },
      destroy: function() {
        Backbone.off("SHOW_PLAYLIST", this.open, this);
        Backbone.View.prototype.destroy.call(this);
      }
    });
  });

}).call(this);
